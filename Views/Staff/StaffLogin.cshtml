@model WebAppHealth.Models.PacsViewModel

@{
    ViewBag.Title = "Pacs";
    Layout = "~/Views/Shared/_HealthLayout.cshtml";

    ViewBag.HideHeaderFooter = true;
    ViewBag.HideFooter = true;
}

@section Styles {
    <link href="~/Content/css/staff-login.css" rel="stylesheet" />
}

<main class="page-container-auth d-flex align-items-center">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-8">
                <div class="auth-container">

                    @using (Html.BeginForm("StaffLogin", "Staff", FormMethod.Post, new { @class = "auth-form needs-validation", novalidate = "novalidate" }))
                    {
                        @Html.AntiForgeryToken()

                        <img src="~/asset/logo_01.png" alt="Logo Bệnh Viện" class="logo_login" />

                        @Html.ValidationSummary(true, "", new { @class = "alert alert-danger", style = "display:none" })

                        <div class="mb-3">
                            @Html.TextBoxFor(m => m.Username, new { @class = "form-control", placeholder = "Nhập tên đăng nhập", required = "required", id = "username" })
                            <div class="invalid-feedback">
                                @Html.ValidationMessageFor(m => m.Username, "Vui lòng nhập tên đăng nhập.")
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="password-field-container position-relative">
                                @Html.PasswordFor(m => m.Password, new { @class = "form-control", placeholder = "Nhập mật khẩu", required = "required", id = "password" })

                                <span class="toggle-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; z-index: 10;">
                                    <i class="fa-regular fa-eye-slash"></i>
                                </span>

                                <div class="invalid-feedback">
                                    @Html.ValidationMessageFor(m => m.Password, "Vui lòng nhập mật khẩu.")
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="form-check">
                                @Html.CheckBoxFor(m => m.RememberMe, new { @class = "form-check-input", id = "rememberMe" })
                                <label class="form-check-label" for="rememberMe">
                                    @Html.DisplayNameFor(m => m.RememberMe)
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success auth-button w-100">
                            Đăng nhập
                        </button>

                        <div class="auth-links mt-3 text-center">
                            <a href="#">Quên Tài khoản/Mật khẩu</a>
                        </div>
                        <div class="auth-links text-center">
                            <a href="tel:0123456789"><i class="fas fa-phone me-1"></i>Hỗ trợ kỹ thuật: 0123 456 789</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // --- XỬ LÝ VALIDATION BOOTSTRAP ---
            var forms = document.querySelectorAll(".needs-validation");
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener("submit", function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add("was-validated");
                }, false);
            });

            // --- XỬ LÝ ẨN/HIỆN MẬT KHẨU ---
            var toggleButtons = document.querySelectorAll(".toggle-password");
            toggleButtons.forEach(function (button) {
                button.addEventListener("click", function () {
                    // Tìm input password (nằm trước thẻ span này)
                    var input = this.previousElementSibling;
                    var icon = this.querySelector("i");

                    if (input && input.tagName === 'INPUT') {
                         if (input.type === "password") {
                            input.type = "text";
                            icon.classList.remove("fa-eye-slash");
                            icon.classList.add("fa-eye");
                        } else {
                            input.type = "password";
                            icon.classList.remove("fa-eye");
                            icon.classList.add("fa-eye-slash");
                        }
                    }
                });
            });

            // Hiện lỗi server trả về (nếu có) bằng CSS của Bootstrap
            var validationSummary = document.querySelector(".validation-summary-errors");
            if(validationSummary){
                validationSummary.classList.add("alert", "alert-danger");
                validationSummary.style.display = "block";
            }
        });
    </script>
}